Vulnerability Status Report
=========================

Author: {{ author }}
Export Date: {{ export_date }}
{% if scan_date is defined %}
Scan Date: {{ scan_date }}
{% endif %}


Overview
--------
This report provides a summary of all vulnerabilities, organized by their current status and severity, with lists of affected packages.
{% set active_statuses = ['under_investigation', 'in_triage', 'affected', 'exploitable'] %}
{% set inactive_statuses = ['fixed', 'resolved', 'resolved_with_pedigree', 'not_affected', 'false_positive'] %}
{% set severity_order = ['critical', 'high', 'medium', 'low', 'none', 'unknown'] %}

{% macro render_vulnerability_section(vulns, section_title) -%}
{{ section_title }} ({{ vulns | length }})
============================================================

{% for severity in severity_order -%}
{% set severity_vulns = vulns | selectattr('severity.severity', 'equalto', severity) | list -%}
{% if severity_vulns | length > 0 -%}
{{ severity | title }} Severity ({{ severity_vulns | length }})
------------------------------------------------------------

{% for vuln in severity_vulns -%}
CVE: {{ vuln.id }}
  Status: {{ vuln.status | title }}
  Affected Packages ({{ vuln.packages | length }}):
  {% for pkg in vuln.packages %}  - {{ pkg }}
  {% endfor -%}
  CVSS Scores:
  {% if vuln.severity.cvss -%}
  {% for cvss in vuln.severity.cvss %}  - CVSS v{{ cvss.version }}: {{ cvss.base_score }} ({{ cvss.vector_string }})
    Exploitability Score: {{ cvss.exploitability_score }}
    Impact Score: {{ cvss.impact_score }}
    Source: {{ cvss.author }}
  {% endfor -%}
  {% else %}  - No CVSS scores available
  {% endif -%}
  EPSS Score: {{ vuln.epss.score | default("None") }}

{% endfor -%}
{% endif -%}
{% endfor -%}
{% endmacro -%}

Vulnerability Summary by Status
------------------------------


{{ render_vulnerability_section(
    vulnerabilities | as_list | selectattr('status', 'in', active_statuses) | list,
    "Active Vulnerabilities"
) }}

{{ render_vulnerability_section(
    vulnerabilities | as_list | selectattr('status', 'in', inactive_statuses) | list,
    "Inactive Vulnerabilities"
) }}

Summary Statistics
-----------------
Total Vulnerabilities: {{ vulnerabilities | length }}

By Status:
----------
{% for status in vulnerabilities | as_list | map(attribute='status') | unique -%}
- {{ status | title }}: {{ vulnerabilities | as_list | selectattr('status', 'equalto', status) | list | length }}
{% endfor %}


By Severity:
-----------
{% for severity in vulnerabilities | as_list | map(attribute='severity.severity') | unique -%}
- {{ severity | title }}: {{ vulnerabilities | as_list | selectattr('severity.severity', 'equalto', severity) | list | length }}
{% endfor -%}
